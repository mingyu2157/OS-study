# Chapter09 운영체제 시작하기

## 운영체제를 알아야 하는 이유

**운영체제** : 실행할 프로그램에 필요한 자원을 할당하고, 프로그램이 올바르게 실행되도록 돕는 특별한 프로그램

**자원** : 프로그램 실행에 필요한 요소

커널(핵심기능) + 도구 및 GUI 소프트웨어 + 장치 드라이버로 구성

운영체제는 실행할 프로그램을 메모리에 적재하고, 더이상 실행되지 않는 프로그램을 메모리에서 삭제함 -> 지속적으로 메모리 자원 관리

운영체제는 컴퓨터가 부팅될 때 메모리 내 **커널 영역**이라는 공간에 따로 적재되어 실행됨 <--> **사용자 영역**(응용 프로그램이 적재됨)

커널 영역과 사용자 영역을 분리하는 이유 : 시스템의 자원을 보호하고, 효율적으로 관리하기 위함



**운영체제를 알아야 하는 이유** 

- 운영체제와의 대화로 하드웨어와 프로그램을 더 깊이 이해하고 문제해결의 실마리를 찾을 수 있다. (ex. 오류 메세지)



## 운영체제의 큰 그림

### -- 커널

**커널** : 운영체제의 핵심 서비스를 담당하는 부분 --> 어떤 커널을 사용하는지에 따라 결과적으로 컴퓨터의 성능에 영향을 줌

커널의 종류

1. 단일형 구조 커널 : 초창기의 운영체제 구조로 핵심 모듈들이 하나로 구성되어 있음 -> 모듈간의 통신비용이 적어 효율적 운영

   but 하나의 모듈에 이상이 생기면 전체에 영향, 매우 크고 복잡한 현대의 운영체제를 구현하기는 어려움(MS-DOS,VMS,초기UNIX)

2. 계층형 구조 커널 : 비슷한 기능을 가진 모듈을 묶어서 하나의 계층으로 만들고, 계층간의 통신을 통해 운영체제를 구현하는 방식

   비슷한 기능을 모아 모듈화 했기 때문에 단일형 구조 커널보다 디버깅에 용이 --> 대부분의 운영체제가 계층형 구조

   계층간 독립성을 부여받아서 오류가 생겨도 해당 계층만 수정하면 됨

   but 계층이 많아질수록 성능이 저하되고 운영체제가 복잡해질수록 커널의 크기와 용량이 커짐

3. 마이크로 구조 커널 : 프로세스 관리, 메모리 관리, IPC등 기본적인 기능만 제공하고 나머지 기능은 사용자 모드에 구현 -> 크기 줄임

   각 모듈이 독립적으로 작용해서 한 모듈에 이상이 생겨도 영향을 주지 않음, 커널의 크기가 작아서 사양이 낮은 CPU에도 설치 가능

   but 모듈 간의 프로세스 통신(IPC)이 발생하여 속도 느림

커널의 구성요소

1. 태스크 관리자 : 물리적 자원인 CPU를 태스크(task)로 제공
2. 메모리 관리자 : 물리적 자원인 메모리를 페이지(page)나 세그먼트(segment)로 제공
3. 파일 시스템 관리자 : 물리적 자원인 디스크를 파일(file)로 제공
4. 네트워크 관리자 : 물리적 자원인 네트워크를 소켓(socket)으로 제공
5. 장치 드라이버 관리자 : 각종 외부장치에 대한 접근



사용자 인터페이스 : 대표적인 커널에 포함되지 않는 서비스 : 컴퓨터와 상호작용 할 수 있는 통로

1. 그래픽 유저 인터페이스 : 그래픽을 기반으로 컴퓨터와 상호작용 할 수 있는 인터페이스
2. 커맨드 라인 인터페이스 : 명령어를 기반으로 컴퓨터와 상호작용 할 수 있는 인터페이스



### -- 이중 모드와 시스템 호출

**이중 모드** : CPU가 명령어를 실행하는 모드를 크게 사용자 모드와 커널 모드로 구분하는 방식

사용자 모드 : 커널 영역의 코드를 실행할 수 없는 모드(운영체제 서비스를 제공받을 수 없는 실행 모드)

커널 모드 : 커널 영역의 코드를 실행할 수 있는 모드(운영체제 서비스를 제공받을 수 있는 실행 모드)

슈퍼바이저 플래그를 통해 어떤 모드인지 알 수 있음

*사용자 모드와 커널 모드를 제공하는 것은 운영체제가 아닌 프로세서이다.



**시스템 호출(시스템 콜)** : 운영체제 서비스를 제공받기 위해 커널 모드로 전환하는 방법 -> 일종의 소프트웨어적 인터럽트

일반적으로 응용 프로그램은 실행 과정에서 운영체제 서비스를 빈번하게 이용 -> 사용자 모드와 커널 모드를 오가며 실행됨

유닉스, 리눅스등의 운영체제에서의 대표적인 시스템 호출의 종류 (참고)

- 프로세스 관리
  - fork() : 새 자식 프로세스 생성
  - execve() : 프로세스 실행(메모리 공간을 새로운 프로그램의 내용으로 덮어 씌움)
  - exit() : 프로세스 종료
  - waitpid() : 자식 프로세스가 종료할 때까지 대기
- 파일 관리
  - open() : 파일 열기
  - close() : 파일 닫기
  - read() : 파일 읽기
  - write() : 파일 쓰기
  - stat() : 파일 정보 획득
- 디렉터리 관리
  - chdir() : 작업 디렉터리 변경
  - mkdir() : 디렉터리 생성
  - rmdir() : 비어있는 디렉터리 삭제
- 파일 시스템 관리
  - mount() : 파일 시스템 마운트
  - umount() : 파일 시스템 마운트 해제

<img src="https://github.com/mingyu2157/computer-architecture/blob/main/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C%EC%9D%98%20%EA%B3%84%EC%B8%B5%EC%A0%81%20%EA%B5%AC%EC%A1%B0%20%EA%B7%B8%EB%A6%BC2.jpg?raw=true">

### -- 운영체제의 핵심 서비스

- 프로세스 관리 : CPU는 한 프로세스를 실행하다가 다른 프로세스로 실행을 전환하고, 또 다른 프로세스로 실행을 전환하는 것을 반복

  --> 운영체제는 다양한 프로세스를 일목요연하게 관리하고 실행할 수 있어야 함 (어떻게 하는지는 10장)

- 자원 접근 및 할당 : 운영체제는 프로세스들이 사용할 자원에 접근하고 조작함으로써 프로세스에 필요한 자원을 할당

  - CPU : CPU는 한번에 하나의 프로세스만 실행가능 -> CPU스케줄링 관리
  - 메모리 : 운영체제는 새로운 프로세스가 적재될 때마다 메모리 할당, 반환, 다른 프로세스와 스레드로부터 보호 등의 일을 한다
  - 입출력장치 : 운영체제는 입출력 장치가 CPU에 하드웨어 인터럽트 요청 신호를 보내면 인터럽트 서비스 루틴을 제공함으로써 입출력 작업을 수행

- 파일 시스템 관리 : 운영체제는 파일 생성, 저장, 읽기, 쓰기, 삭제, 복사, 이동, 보호 등의 일과 파일 시스템을 관리

- +사용자 인터페이스, 네트워킹, 보호 및 보안등의 일을 함



### -- 가상 머신과 이중 모드의 발전

- 가상 머신을 통한 가상화를 지원하는 현대 CPU는 두 가지 모드 이상을 지원

- 가상 머신(virture machine) : 소프트웨어적으로 만들어낸 가상 컴퓨터

- 가상 머신을 설치하면 새로운 운영체제와 응용 프로그램들을 설치하고 실행 할 수 있음 --> 사용자 모드로 실행됨

  --> 가상화를 지원하는 CPU는 이중 모드 외에 하이퍼 바이저 모드를 둠

  ++ 모바일 프로그래밍을 할 때 안드로이드 스튜디오를 사용한다면 가상 디바이스에다가 직접 만든 어플리케이션을 실행시킬 수 있음

  윈도우 OS에서는 돌아가지 않는 모바일 어플리케이션(apk)을 만들고 실행하기 위해 가상 머신을 실행한 후, 안드로이드 OS를 실행시킨 후 모바일 어플리케이션을 실행하는 방식

  



